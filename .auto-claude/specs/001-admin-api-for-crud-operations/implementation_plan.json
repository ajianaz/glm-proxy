{
  "feature": "Admin API for CRUD Operations",
  "description": "# Admin API for CRUD Operations\n\nRESTful API endpoints for programmatic API key management including create, read, update, delete operations with proper authentication and authorization.\n\n## Rationale\nEnables automation, integration with existing tools, and programmatic key management. Critical for DevOps workflows and CI/CD pipelines. Addresses gap where users must manually edit files.\n\n## User Stories\n- As a DevOps engineer, I want to automate API key provisioning through scripts so that I can integrate with our user onboarding system\n- As a developer, I want to programmatically manage test API keys so that I can automate test environment setup\n- As an integrator, I want to call an API to manage keys so that I can build custom tooling on top of GLM Proxy\n\n## Acceptance Criteria\n- [ ] POST /admin/api/keys - Create new API key with validation\n- [ ] GET /admin/api/keys - List all API keys with pagination\n- [ ] GET /admin/api/keys/:id - Get specific API key details\n- [ ] PUT /admin/api/keys/:id - Update API key properties\n- [ ] DELETE /admin/api/keys/:id - Delete API key\n- [ ] Admin API requires master API key or separate admin token\n- [ ] API returns proper HTTP status codes and error messages\n- [ ] Operations are atomic and prevent race conditions\n",
  "created_at": "2026-01-22T03:26:41.676Z",
  "updated_at": "2026-01-22T05:11:49.790Z",
  "status": "in_progress",
  "phases": [
    {
      "id": "phase-1",
      "name": "Project Setup & Environment",
      "status": "in_progress",
      "subtasks": [
        {
          "id": "setup-1",
          "name": "Initialize project structure",
          "status": "completed",
          "details": "Create project directory structure, initialize package.json with Bun, setup TypeScript configuration"
        },
        {
          "id": "setup-2",
          "name": "Install dependencies",
          "status": "completed",
          "details": "Install Bun, required packages for HTTP server, database, validation, and testing"
        },
        {
          "id": "setup-3",
          "name": "Setup environment configuration",
          "status": "completed",
          "details": "Create .env.example, environment variable loading, configuration management"
        },
        {
          "id": "setup-4",
          "name": "Create directory structure",
          "status": "completed",
          "details": "Setup src/, routes/, models/, middleware/, tests/ directories"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Database Schema & Models",
      "status": "in_progress",
      "subtasks": [
        {
          "id": "db-1",
          "name": "Design API keys table schema",
          "status": "completed",
          "details": "Define schema with fields: id, key_hash, name, description, scopes, rate_limit, is_active, created_at, updated_at"
        },
        {
          "id": "db-2",
          "name": "Implement database initialization",
          "status": "completed",
          "details": "Create SQLite database using bun:sqlite, run migrations, setup connection pooling"
        },
        {
          "id": "db-3",
          "name": "Create API key model",
          "status": "completed",
          "details": "Implement ApiKey model with CRUD operations, validation, and helper methods"
        },
        {
          "id": "db-4",
          "name": "Add database indexes",
          "status": "completed",
          "details": "Add indexes on key_hash, name, and is_active for performance"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Authentication & Authorization",
      "status": "in_progress",
      "subtasks": [
        {
          "id": "auth-1",
          "name": "Implement admin authentication middleware",
          "status": "completed",
          "details": "Create middleware to validate master API key or admin token from Authorization header"
        },
        {
          "id": "auth-2",
          "name": "Create token generation/validation",
          "status": "completed",
          "details": "Implement secure token generation for admin access, validation logic"
        },
        {
          "id": "auth-3",
          "name": "Add error handling for auth failures",
          "status": "completed",
          "details": "Return 401 Unauthorized for missing/invalid credentials, 403 Forbidden for insufficient permissions"
        },
        {
          "id": "auth-4",
          "name": "Setup admin credential storage",
          "status": "completed",
          "details": "Securely store master API key hash in database or environment variables"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "CRUD API Endpoints",
      "status": "in_progress",
      "subtasks": [
        {
          "id": "api-1",
          "name": "Create POST /admin/api/keys endpoint",
          "status": "completed",
          "details": "Implement API key creation with validation (name, scopes, rate_limit), return 201 with created key"
        },
        {
          "id": "api-2",
          "name": "Create GET /admin/api/keys endpoint",
          "status": "completed",
          "details": "Implement list all API keys with pagination (page, limit query params), return 200 with array"
        },
        {
          "id": "api-3",
          "name": "Create GET /admin/api/keys/:id endpoint",
          "status": "completed",
          "details": "Implement get specific API key by ID, return 200 with key details or 404 if not found"
        },
        {
          "id": "api-4",
          "name": "Create PUT /admin/api/keys/:id endpoint",
          "status": "completed",
          "details": "Implement update API key properties (name, description, scopes, rate_limit, is_active), return 200 with updated key"
        },
        {
          "id": "api-5",
          "name": "Create DELETE /admin/api/keys/:id endpoint",
          "status": "completed",
          "details": "Implement delete API key (soft delete or hard delete), return 204 on success"
        },
        {
          "id": "api-6",
          "name": "Add request validation middleware",
          "status": "completed",
          "details": "Validate request bodies, query parameters, and path parameters before processing"
        },
        {
          "id": "api-7",
          "name": "Implement atomic operations",
          "status": "completed",
          "details": "Use database transactions to prevent race conditions during concurrent updates"
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Error Handling & Response Formatting",
      "status": "in_progress",
      "subtasks": [
        {
          "id": "error-1",
          "name": "Create error response formatter",
          "status": "completed",
          "details": "Standardize error response format with { error: string, details?: any }"
        },
        {
          "id": "error-2",
          "name": "Add validation error responses",
          "status": "completed",
          "details": "Return 400 Bad Request with field-level validation errors"
        },
        {
          "id": "error-3",
          "name": "Add not found handling",
          "status": "pending",
          "details": "Return 404 for non-existent resources with helpful error messages"
        },
        {
          "id": "error-4",
          "name": "Add server error handling",
          "status": "pending",
          "details": "Return 500 Internal Server Error for unexpected errors, log details"
        },
        {
          "id": "error-5",
          "name": "Implement request logging",
          "status": "pending",
          "details": "Log all admin API requests with method, path, status, and timing"
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "Testing",
      "status": "in_progress",
      "subtasks": [
        {
          "id": "test-1",
          "name": "Setup test environment",
          "status": "pending",
          "details": "Configure bun test, setup test database, create test fixtures"
        },
        {
          "id": "test-2",
          "name": "Write unit tests for models",
          "status": "pending",
          "details": "Test ApiKey model methods, validation, and database operations"
        },
        {
          "id": "test-3",
          "name": "Write unit tests for middleware",
          "status": "pending",
          "details": "Test authentication middleware, validation middleware"
        },
        {
          "id": "test-4",
          "name": "Write integration tests for POST endpoint",
          "status": "completed",
          "details": "Test API key creation, validation, error cases"
        },
        {
          "id": "test-5",
          "name": "Write integration tests for GET endpoints",
          "status": "pending",
          "details": "Test list and retrieve endpoints, pagination, filters"
        },
        {
          "id": "test-6",
          "name": "Write integration tests for PUT endpoint",
          "status": "pending",
          "details": "Test update operations, partial updates, validation"
        },
        {
          "id": "test-7",
          "name": "Write integration tests for DELETE endpoint",
          "status": "pending",
          "details": "Test deletion, non-existent resources, soft/hard delete"
        },
        {
          "id": "test-8",
          "name": "Write authentication tests",
          "status": "pending",
          "details": "Test valid/invalid credentials, missing auth, permission checks"
        },
        {
          "id": "test-9",
          "name": "Write concurrency tests",
          "status": "completed",
          "details": "Test atomic operations with concurrent requests"
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "Documentation",
      "status": "pending",
      "subtasks": [
        {
          "id": "doc-1",
          "name": "Create API documentation",
          "status": "pending",
          "details": "Document all endpoints, request/response formats, authentication method"
        },
        {
          "id": "doc-2",
          "name": "Create usage examples",
          "status": "pending",
          "details": "Provide curl examples and code samples in multiple languages"
        },
        {
          "id": "doc-3",
          "name": "Document setup and deployment",
          "status": "pending",
          "details": "Create README with setup instructions, environment configuration, running the server"
        },
        {
          "id": "doc-4",
          "name": "Add inline code comments",
          "status": "pending",
          "details": "Document complex logic, security considerations, and design decisions"
        }
      ]
    },
    {
      "id": "phase-8",
      "name": "Security Hardening",
      "status": "pending",
      "subtasks": [
        {
          "id": "sec-1",
          "name": "Secure API key storage",
          "status": "pending",
          "details": "Hash API keys using bcrypt/scrypt before storing, never return full key in list operations"
        },
        {
          "id": "sec-2",
          "name": "Add rate limiting",
          "status": "pending",
          "details": "Implement rate limiting on admin endpoints to prevent abuse"
        },
        {
          "id": "sec-3",
          "name": "Add CORS configuration",
          "status": "pending",
          "details": "Configure CORS headers appropriately for admin API"
        },
        {
          "id": "sec-4",
          "name": "Sanitize error messages",
          "status": "pending",
          "details": "Ensure error messages don't leak sensitive information"
        }
      ]
    }
  ],
  "planStatus": "in_progress",
  "recoveryNote": "Task recovered from stuck state at 2026-01-22T03:30:27.417Z"
}